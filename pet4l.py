#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import os
import sys


if __name__ == '__main__':
    # parse input if there's `--clear[?]Data` flags
    import argparse
    parser = argparse.ArgumentParser(description='PET4L')
    parser.add_argument('--clearAppData', dest='clearAppData', action='store_true',
                        help='clear all previously saved application data')
    parser.add_argument('--clearTxCache', dest='clearTxCache', action='store_true',
                        help='clear raw transactions cache')
    parser.set_defaults(clearAppData=False)
    parser.set_defaults(clearTxCache=False)
    args = parser.parse_args()

    if getattr(sys, 'frozen', False):
        # running in a bundle
        sys.path.append(os.path.join(sys._MEIPASS, 'src'))
        imgDir = os.path.join(sys._MEIPASS, 'img')

        # if linux export qt plugins path
        if sys.platform == 'linux':
            os.environ['QT_QPA_PLATFORM_PLUGIN_PATH'] = os.path.join(sys._MEIPASS, 'PyQt5', 'Qt', 'plugins')

    else:
        # running live
        sys.path.append(os.path.join(os.path.dirname(os.path.abspath(__file__)), 'src'))
        imgDir = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'img')

    from PyQt5.QtWidgets import QApplication
    from mainApp import App

    # Create QApplication
    app = QApplication(sys.argv)

    # Create QMainWindow Widget
    ex = App(imgDir, app, args)

    # Launch RPC watchdog
    ex.mainWindow.rpc_watchdogThread.start()

    # Execute the application
    app.exec_()
    try:
        app.deleteLater()
    except Exception as e:
        print(e)

    sys.exit()
